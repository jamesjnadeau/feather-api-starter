var _ = require('lodash');
module.exports = function(id, data, params, cb) {
  if (_.isFunction(data)) {
    cb = data;
    return cb(new errors.BadRequest('You need to provide data to be updated'));
  }

  if (_.isFunction(params)) {
    cb = params;
    params = {};
  }
  console.log('data', data);

  this.model.findById(id.toString(), function(error, result) {

    if (error) {
      return cb(new errors.BadRequest(error));
    }

    if (!result) {
      return cb(new errors.NotFound('No record found for id ' + id));
    }

    for(var key in data) {
      switch(typeof data[key]) {
        case 'object':
          result[key] = _.extend({}, result[key], data[key]);
          break;

        default:
          result[key] = data[key];
          break;
      }

    }
    console.log(result);

    result.save(function(err) {
      if (err) {
        return cb(new errors.BadRequest(err));
      }

      console.log('patch saved');
      cb(null, result);
    })
  });
}
